# 项目：求解正负电荷构成的泊松方程 - 实验报告

**学生姓名：** [滕欣玥] **学号：** [20221050199] **完成日期：** [2025.6.18]

## 1. 实验目的

学习使用松弛迭代法求解二维泊松方程，理解有限差分法在椭圆型偏微分方程数值求解中的应用。

## 2. 核心算法

### 2.1 算法思路

使用有限差分法将泊松方程 $\nabla^2 \phi = -\rho/\varepsilon_0$ 离散化，然后通过松弛迭代法求解线性方程组。核心迭代公式为：

$$\phi_{i,j} = \frac{1}{4}(\phi_{i+1,j} + \phi_{i-1,j} + \phi_{i,j+1} + \phi_{i,j-1} + h^2\rho_{i,j})$$

### 2.2 关键代码片段

```python
def solve_poisson_equation(M: int = 100, target: float = 1e-6, max_iterations: int = 10000) -> Tuple[np.ndarray, int, bool]:
    """
    使用松弛迭代法求解二维泊松方程
    
    参数:
        M (int): 每边的网格点数，默认100
        target (float): 收敛精度，默认1e-6
        max_iterations (int): 最大迭代次数，默认10000
    
    返回:
        tuple: (phi, iterations, converged)
            phi (np.ndarray): 电势分布数组，形状为(M+1, M+1)
            iterations (int): 实际迭代次数
            converged (bool): 是否收敛
    
    物理背景:
        求解泊松方程 ∇²φ = -ρ/ε₀，其中：
        - φ 是电势
        - ρ 是电荷密度分布
        - 边界条件：四周电势为0
        - 正电荷位于 (60:80, 20:40)，密度 +1 C/m²
        - 负电荷位于 (20:40, 60:80)，密度 -1 C/m²
    
    数值方法:
        使用有限差分法离散化，迭代公式：
        φᵢⱼ = 0.25 * (φᵢ₊₁ⱼ + φᵢ₋₁ⱼ + φᵢⱼ₊₁ + φᵢⱼ₋₁ + h²ρᵢⱼ)
    """
    # TODO: 设置网格间距
    h = 1.0
    
    # TODO: 初始化电势数组，形状为(M+1, M+1)
    phi = np.zeros((M+1, M+1), dtype=float)

    # TODO: 创建电荷密度数组
    rho = np.zeros((M+1, M+1), dtype=float)
    
    # TODO: 设置电荷分布
    scale = M / 100  # 尺寸缩放
    rho[int(60*scale):int(80*scale), int(20*scale):int(40*scale)] = 1.0
    rho[int(20*scale):int(40*scale), int(60*scale):int(80*scale)] = -1.0
    
    # TODO: 初始化迭代变量
    delta = 1.0  # 用于存储最大变化量
    iterations = 0  # 迭代计数器
    converged = False  # 收敛标志
    
    # TODO: 创建前一步的电势数组副本
    phi_prev = np.copy(phi)

    
    # TODO: 主迭代循环
    # while delta > target and iterations < max_iterations:
    #     # 1. 使用有限差分公式更新内部网格点
    #     #    phi[1:-1, 1:-1] = 0.25 * (...)
    #     # 2. 计算最大变化量
    #     #    delta = np.max(np.abs(phi - phi_prev))
    #     # 3. 更新前一步解
    #     #    phi_prev = np.copy(phi)
    #     # 4. 增加迭代计数
    #     #    iterations += 1
    
    # TODO: 检查是否收敛
    # converged = (delta <= target)
    while delta > target and iterations < max_iterations:
        # 使用有限差分公式更新内部网格点
        phi[1:-1, 1:-1] = 0.25 * (
            phi_prev[2:, 1:-1] + phi_prev[:-2, 1:-1] +
            phi_prev[1:-1, 2:] + phi_prev[1:-1, :-2] +
            h**2 * rho[1:-1, 1:-1]
        )
        
        # 计算最大变化量
        delta = np.max(np.abs(phi - phi_prev))
        
        # 更新前一步解
        phi_prev = np.copy(phi)
    
        # 增加迭代计数
        iterations += 1
    
    # TODO: 返回结果
    converged = bool(delta <= target)#  收敛标志
    return phi, iterations, converged
```

## 3. 实验结果

### 3.1 主要输出

- **迭代次数：** [9219]
- **收敛状态：** [是]
- **最大电势：** [100.295618] V
- **最小电势：** [-100.296518] V
- **电势范围：** 最大电势位置[70，30] V 最小电势位置[30，70] V
                  

### 3.2 电势分布图

[在此插入电势分布的可视化图像]
![image](https://github.com/user-attachments/assets/87f25854-2cfa-4118-9a67-b726f95cc723)


### 3.3 结果验证

1. **边界条件检查：** 四周边界电势均为0V，满足边界条件
2. **物理合理性：** 正电荷附近电势较高，负电荷附近电势较低
3. **对称性：** 由于电荷分布的对称性，电势分布也呈现相应的对称特征

## 4. 问题与收获

### 4.1 主要问题

1. **收敛速度问题：** 初始时迭代收敛较慢，需要合理设置收敛精度
2. **边界条件处理：** 需要确保在每次迭代中正确维护边界条件

### 4.2 解决方法

1. **优化迭代：** 使用适当的松弛因子可以加速收敛
2. **数组操作：** 利用NumPy的数组切片功能高效更新内部网格点

### 4.3 主要收获

通过本实验，我深入理解了有限差分法的基本原理，掌握了松弛迭代法求解椭圆型偏微分方程的方法，并学会了使用Python进行科学计算和可视化。

## 5. 思考题

### 5.1 网格密度的影响

**问题：** 增加网格密度对解的精度和计算时间有什么影响？

**回答：** [增加网格密度（即增大 $M$）会使每个网格单元更小，能够更精细地描述电荷分布和电势变化，从而提高解的精度。高密度网格能更准确地反映电荷边界处的电势梯度和细节。但同时，网格点数的增加会显著提升计算量，导致每次迭代的计算时间变长，且达到收敛所需的总迭代次数也可能增加。因此，解的精度提升的同时，计算时间也会大幅增加。]
eg.m=10
![image](https://github.com/user-attachments/assets/8fe50083-892b-4e05-8e57-e463cabfd825)
迭代次数: 90
是否收敛: True
最大电势: 0.981225 V
最小电势: -0.981225 V

### 5.2 收敛判据的选择

**问题：** 不同的收敛精度设置如何影响最终结果？

**回答：** [收敛精度（如 $10^{-4}$、$10^{-6}$ 等）决定了迭代停止的条件。收敛精度越高（数值越小），最终解与真实解的误差越小，结果更精确，但需要更多的迭代次数，计算时间更长。若收敛精度较低，虽然计算速度快，但解的误差较大，可能无法准确反映物理现象。因此，收敛判据需要在计算效率和解的精度之间权衡选择。]

### 5.3 物理意义

**问题：** 从物理角度解释为什么正负电荷之间会形成这样的电势分布？

**回答：** [正负电荷之间会形成明显的电势分布，是因为电势是电场的势函数。正电荷产生的电场向外，负电荷产生的电场向内，二者叠加后在空间形成由高电势（正电荷附近）到低电势（负电荷附近）的分布。电势在正电荷区域达到最大值，在负电荷区域达到最小值，二者之间形成电势梯度，电场线从正电荷指向负电荷。这反映了电荷间的相互作用和能量分布，是电场和电势基本物理规律的体现。]

## 6. 代码改进建议

1. **性能优化：** 可以考虑使用SOR（逐次超松弛）方法加速收敛
2. **可视化增强：** 添加等势线图和电场矢量图
3. **参数化设计：** 使电荷位置和强度可配置

## 7. 参考资料

1. 计算物理学教材相关章节
2. NumPy和Matplotlib官方文档
3. 数值分析相关资料
